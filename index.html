<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>엔터테인먼트 투자제안 자동계산</title>
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
  <style>
    body { background: #f7f9fa; font-family: "Noto Sans KR", sans-serif; padding: 20px; }
    .form-box { max-width: 700px; margin: 0 auto; background: #fff; border-radius: 18px; padding: 36px; box-shadow: 0 2px 8px #0001; }
    h2 { margin-bottom: 16px; }
    input, select { margin: 4px 0 10px 0; padding: 6px 10px; border-radius: 8px; border: 1px solid #ddd; }
    .row { margin-bottom: 12px; }
    label { min-width: 120px; display: inline-block; }
    button { background: #006afe; color: #fff; border: none; border-radius: 10px; padding: 8px 18px; font-weight: 700; margin-left: 4px;}
    .result { background: #e8ffe8; margin-top: 24px; padding: 18px; border-radius: 12px; }
    .flex { display: flex; gap: 12px; align-items: center; }
    .cost-list, .rev-list, .ticket-list { margin-bottom: 10px; }
    .cost-list input, .rev-list input, .ticket-list input { width: 90px; }
    .ticket-list input[type="text"] { width: 60px; }
    .cost-list > div, .rev-list > div, .ticket-list > div { display: flex; align-items: center; gap: 5px; margin-bottom: 2px;}
    .cost-list button, .rev-list button, .ticket-list button { background: #e53e3e; color: #fff; padding: 4px 10px; font-size: 13px; }
    .row > button { background: #006afe; padding: 4px 10px; font-size: 13px; }
  </style>
</head>
<body>
  <div class="form-box">
    <h2>엔터테인먼트 투자제안 자동계산·접수 (HTML Only)</h2>
    <form id="mainForm">
      <div class="row"><label>사업명:</label><input name="projectName" required></div>
      <div class="row">
        <label>사업유형:</label>
        <input type="checkbox" name="type" value="콘서트">콘서트
        <input type="checkbox" name="type" value="팬미팅">팬미팅
        <input type="checkbox" name="type" value="MD수입">MD수입
        <input type="checkbox" name="type" value="굿즈">굿즈
        <input type="checkbox" name="type" value="기타">기타
      </div>
      <div class="row"><label>아티스트명:</label><input name="artist" required></div>
      <div class="row"><label>콘서트장 위치:</label><input name="venue" required></div>
      <div class="row"><label>좌석수:</label><input type="number" name="seatCount" required></div>

      <div class="row">
        <label>티켓정보:</label>
        <div class="ticket-list" id="ticketList"></div>
        <button type="button" onclick="addTicket()">+ 티켓추가</button>
      </div>

      <div class="row"><label>투자요청금액(KRW):</label><input type="number" name="requestAmount" required></div>
      <div class="row flex">
        <label>콘서트 시작:</label><input type="date" name="showStart">
        <label>종료:</label><input type="date" name="showEnd">
      </div>
      <div class="row flex">
        <label>투자금 운용:</label><input type="date" name="investStart">
        <label>~</label><input type="date" name="investEnd">
      </div>
      <div class="row flex">
        <label>원금회수:</label><input type="date" name="principalReturnStart">
        <label>~</label><input type="date" name="principalReturnEnd">
      </div>
      <div class="row flex">
        <label>수익분배:</label><input type="date" name="profitDistStart">
        <label>~</label><input type="date" name="profitDistEnd">
      </div>
      <div class="row flex">
        <label>수익배분:</label>
        투자자 <input type="number" name="investorShare" min="0" max="100" value="70" style="width:50px">%
        사업주체 <input type="number" name="ownerShare" min="0" max="100" value="30" style="width:50px">%
      </div>

      <div class="row">
        <label>비용내역:</label>
        <div class="cost-list" id="costList"></div>
        <button type="button" onclick="addCost()">+ 비용추가</button>
      </div>
      <div class="row">
        <label>수익내역:</label>
        <div class="rev-list" id="revList"></div>
        <button type="button" onclick="addRev()">+ 수익추가</button>
      </div>
      <div class="row">
        <label>첨부파일:</label>
        <input type="file" id="fileInput" name="files" multiple>
      </div>
      <div class="row">
        <button type="button" onclick="calculate()">자동계산</button>
        <button type="submit" id="submitBtn">접수</button>
      </div>
    </form>

    <div class="result" id="result" style="display:none"></div>
    <div class="result" id="mailResult" style="display:none"></div>
  </div>
  <script>
    // 동적 행 추가/삭제
    function addCost() {
      const d = document.createElement("div");
      d.innerHTML = `
        <input placeholder="비용명" class="costname">
        <input type="number" class="costval" placeholder="금액">
        <button type="button" onclick="this.parentElement.remove()">삭제</button>
      `;
      document.getElementById("costList").appendChild(d);
    }
    function addRev() {
      const d = document.createElement("div");
      d.innerHTML = `
        <input placeholder="수익명" class="revname">
        <input type="number" class="revval" placeholder="금액">
        <button type="button" onclick="this.parentElement.remove()">삭제</button>
      `;
      document.getElementById("revList").appendChild(d);
    }
    function addTicket() {
      const d = document.createElement("div");
      d.innerHTML = `
        <input type="text" placeholder="종류" class="ticketType">
        <input type="number" placeholder="좌석수" class="ticketCount">
        <input type="number" placeholder="금액" class="ticketPrice">
        <button type="button" onclick="this.parentElement.remove()">삭제</button>
      `;
      document.getElementById("ticketList").appendChild(d);
    }
    // 기본 비용/수익/티켓 한행
    window.onload = function() {
      addCost(); addRev(); addTicket();
    }

    // 자동계산
    function calculate() {
      let totalCost = 0, totalRevenue = 0, ticketRevenue = 0;
      // 비용
      document.querySelectorAll('.costval').forEach(x => totalCost += Number(x.value || 0));
      // 수익
      document.querySelectorAll('.revval').forEach(x => totalRevenue += Number(x.value || 0));
      // 티켓
      document.querySelectorAll('.ticketCount').forEach((el, i) => {
        const price = Number(document.querySelectorAll('.ticketPrice')[i].value || 0);
        const count = Number(el.value || 0);
        ticketRevenue += price * count;
      });
      totalRevenue += ticketRevenue;
      // ROI
      let ROI = totalCost > 0 ? (((totalRevenue - totalCost) / totalCost) * 100).toFixed(2) : "0";
      // BEP
      let seatSum = 0, priceSum = 0;
      document.querySelectorAll('.ticketCount').forEach((el, i) => {
        seatSum += Number(el.value || 0);
        priceSum += Number(document.querySelectorAll('.ticketPrice')[i].value || 0);
      });
      let BEP = priceSum > 0 ? Math.ceil(totalCost / priceSum) : "0";
      // 수익배분
      const investorShare = Number(document.querySelector('input[name=investorShare]').value || 0);
      const ownerShare = 100 - investorShare;
      document.querySelector('input[name=ownerShare]').value = ownerShare;
      const investorProfit = Math.floor(totalRevenue * investorShare / 100);
      const ownerProfit = Math.floor(totalRevenue * ownerShare / 100);

      let html = `
        총비용: <b>${totalCost.toLocaleString()}원</b><br>
        총수익: <b>${totalRevenue.toLocaleString()}원</b><br>
        ROI: <b>${ROI}%</b><br>
        BEP(손익분기점): <b>${BEP}매(티켓단가별)</b><br>
        투자자몫: <b>${investorProfit.toLocaleString()}원</b> / 사업주체몫: <b>${ownerProfit.toLocaleString()}원</b>
      `;
      document.getElementById("result").innerHTML = html;
      document.getElementById("result").style.display = "block";
    }

    // EmailJS 초기화
    emailjs.init("YOUR_PUBLIC_KEY"); // <-- 본인 EmailJS public key 입력

    // 제출
    document.getElementById("mainForm").onsubmit = async function(ev) {
      ev.preventDefault();
      document.getElementById("mailResult").style.display = "none";
      // 입력 정리
      const f = ev.target;
      let types = [];
      f.querySelectorAll("input[name=type]:checked").forEach(x=>types.push(x.value));
      // 비용, 수익, 티켓
      let costs = [], revs = [], tickets = [];
      f.querySelectorAll('.cost-list div').forEach(d=>{
        let name = d.querySelector('.costname').value, val = d.querySelector('.costval').value;
        if(name && val) costs.push(name+": "+val+"원");
      });
      f.querySelectorAll('.rev-list div').forEach(d=>{
        let name = d.querySelector('.revname').value, val = d.querySelector('.revval').value;
        if(name && val) revs.push(name+": "+val+"원");
      });
      f.querySelectorAll('.ticket-list div').forEach(d=>{
        let t = d.querySelector('.ticketType').value,
            c = d.querySelector('.ticketCount').value,
            p = d.querySelector('.ticketPrice').value;
        if(t && c && p) tickets.push(`${t} - ${c}석 × ${p}원`);
      });

      // 계산
      calculate();
      let calcRes = document.getElementById("result").innerHTML.replace(/<[^>]+>/g, "\n").replace(/&nbsp;/g, " ");
      // 첨부파일 준비
      const files = document.getElementById("fileInput").files;
      // EmailJS 전송 파라미터
      const templateParams = {
        message: `
[사업명] ${f.projectName.value}
[사업유형] ${types.join(",")}
[아티스트] ${f.artist.value}
[콘서트장] ${f.venue.value} (좌석수: ${f.seatCount.value})
[티켓종류] ${tickets.join(";")}
[투자요청금액] ${f.requestAmount.value}원
[기간]
- 콘서트: ${f.showStart.value} ~ ${f.showEnd.value}
- 투자금 운용: ${f.investStart.value} ~ ${f.investEnd.value}
- 원금회수: ${f.principalReturnStart.value} ~ ${f.principalReturnEnd.value}
- 수익분배: ${f.profitDistStart.value} ~ ${f.profitDistEnd.value}
[수익배분] 투자자 ${f.investorShare.value}%, 사업주체 ${f.ownerShare.value}%
[비용] ${costs.join(";")}
[수익] ${revs.join(";")}
----------------
[자동계산]
${calcRes}
----------------
        `
      };

      // 첨부파일 지원: EmailJS 템플릿에서 input[file] 항목 사용
      let formData = new FormData();
      formData.append("message", templateParams.message);
      for(let i=0; i<files.length; i++) {
        formData.append(`file${i+1}`, files[i], files[i].name);
      }

      document.getElementById("submitBtn").innerText = "전송중...";
      document.getElementById("submitBtn").disabled = true;

      try {
        await emailjs.sendForm(
          "YOUR_SERVICE_ID",  // EmailJS 서비스 ID
          "YOUR_TEMPLATE_ID", // EmailJS 템플릿 ID
          f // HTML Form 객체 (input[file] 자동 첨부됨)
        );
        document.getElementById("mailResult").innerHTML = "<b>접수완료!</b> 입력내용이 이메일로 전송되었습니다.";
      } catch(e) {
        document.getElementById("mailResult").innerHTML = "<b>오류:</b> "+e.text;
      }
      document.getElementById("mailResult").style.display = "block";
      document.getElementById("submitBtn").innerText = "접수";
      document.getElementById("submitBtn").disabled = false;
    }
  </script>
</body>
</html>

